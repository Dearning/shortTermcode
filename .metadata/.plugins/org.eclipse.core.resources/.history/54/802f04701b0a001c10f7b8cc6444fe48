package cn.edu.zucc.personplan.comtrol.example;

import java.sql.Connection;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import cn.edu.zucc.personplan.itf.IPlanManager;
import cn.edu.zucc.personplan.model.BeanPlan;
import cn.edu.zucc.personplan.model.BeanUser;
import cn.edu.zucc.personplan.util.BaseException;
import cn.edu.zucc.personplan.util.BusinessException;
import cn.edu.zucc.personplan.util.DBUtil;
import cn.edu.zucc.personplan.util.DbException;

public class ExamplePlanManager implements IPlanManager {

	@Override
	public BeanPlan addPlan(String name) throws BaseException {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public List<BeanPlan> loadAll() throws BaseException {
		List<BeanPlan> result=new ArrayList<BeanPlan>();
		BeanPlan p=new BeanPlan();
		result.add(p);
		return result;
		
		Connection connection =null;
		try {
			connection=DBUtil.getConnection();
			String sqlString ="select user_id from tbl_user where user_id = ?";
			//准备执行的语句
			java.sql.PreparedStatement pStatement = connection.prepareStatement(sqlString);
			pStatement.setString(1, userid);
			//执行语句
			java.sql.ResultSet rSet = pStatement.executeQuery();
			if(rSet.next()) {
				rSet.close();
				pStatement.close();
				throw new BusinessException("用户已存在");
			}
			//关闭前面的数据库执行语句,并新建插入语句,进行执行
			rSet.close();
			pStatement.close();
			//
			sqlString ="insert into tbl_user(user_id, user_pwd,register_time) values(?,?,?)";
			pStatement =connection.prepareStatement(sqlString);
			pStatement.setString(1, userid);
			pStatement.setString(2, pwd);
			pStatement.setTimestamp(3, new java.sql.Timestamp(System.currentTimeMillis()));
			pStatement.execute();
			//执行结束
			BeanUser user =new BeanUser();
			user.setUser_id(userid);
			user.setRegister_time(new Date());
			return user;
			
		} catch (Exception e) {
			// TODO: handle exception
			e.printStackTrace();
			throw new DbException(e);
		}finally {
			if(connection!=null) {
				try {
					connection.close();
				} catch (Exception e2) {
					// TODO: handle exception
					e2.printStackTrace();
				}
			}
		}
	}

	@Override
	public void deletePlan(BeanPlan plan) throws BaseException {
		
	}

}
